@model Laba1_2.Areas.Student.Controllers.StudentDashboardViewModel
@{
    ViewData["Title"] = "Панель управління | Студент";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="~/css/student-dashboard.css?v=@DateTime.Now.Ticks" />

<div class="container-fluid py-4">
    <!-- Welcome Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="welcome-card text-white p-4 p-md-5">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h2 class="fw-bold mb-2 display-6">Вітаємо, @Model.UserName! 👋</h2>
                        <p class="mb-0 fs-5 opacity-75">Продовжуйте вдосконалювати свої навички програмування</p>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <div class="rank-badge bg-white bg-opacity-25 rounded-pill px-4 py-2 d-inline-block">
                            <span class="text-uppercase fw-bold">Загальний бал: @Model.TotalPoints</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="row g-4 mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="stats-card h-100 border-start border-5 border-success">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="icon-circle bg-success-light me-3">
                            <i class="bi bi-check-circle-fill text-success fs-4"></i>
                        </div>
                        <div class="flex-grow-1">
                            <p class="text-muted fw-semibold mb-1 small">Завершено</p>
                            <h3 class="fw-bold mb-0 text-success">@Model.TotalCompleted</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stats-card h-100 border-start border-5 border-warning">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="icon-circle bg-warning-light me-3">
                            <i class="bi bi-clock-fill text-warning fs-4"></i>
                        </div>
                        <div class="flex-grow-1">
                            <p class="text-muted fw-semibold mb-1 small">В процесі</p>
                            <h3 class="fw-bold mb-0 text-warning">@Model.TotalInProgress</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stats-card h-100 border-start border-5 border-info">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="icon-circle bg-info-light me-3">
                            <i class="bi bi-trophy-fill text-info fs-4"></i>
                        </div>
                        <div class="flex-grow-1">
                            <p class="text-muted fw-semibold mb-1 small">Набрано балів</p>
                            <h3 class="fw-bold mb-0 text-info">@Model.TotalPoints</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stats-card h-100 border-start border-5 border-primary">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="icon-circle bg-primary-light me-3">
                            <i class="bi bi-star-fill text-primary fs-4"></i>
                        </div>
                        <div class="flex-grow-1">
                            <p class="text-muted fw-semibold mb-1 small">Доступно нових</p>
                            <h3 class="fw-bold mb-0 text-primary">@Model.RecommendedChallenges.Count</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content with Tabs -->
    <div class="row">
        <div class="col-12">
            <div class="main-card">
                <div class="card-header bg-transparent border-0 pt-4 px-4 pb-0">
                    <ul class="nav nav-tabs nav-tabs-custom" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="recommended-tab" data-bs-toggle="tab" data-bs-target="#recommended" type="button">
                                <i class="bi bi-stars me-2"></i>Рекомендовані
                                <span class="badge rounded-pill bg-primary ms-2">@Model.RecommendedChallenges.Count</span>
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="inprogress-tab" data-bs-toggle="tab" data-bs-target="#inprogress" type="button">
                                <i class="bi bi-clock-history me-2"></i>В процесі
                                <span class="badge rounded-pill bg-warning ms-2">@Model.InProgressChallenges.Count</span>
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed" type="button">
                                <i class="bi bi-check-circle me-2"></i>Завершені
                                <span class="badge rounded-pill bg-success ms-2">@Model.CompletedChallenges.Count</span>
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="activity-tab" data-bs-toggle="tab" data-bs-target="#activity" type="button">
                                <i class="bi bi-activity me-2"></i>Активність
                            </button>
                        </li>
                    </ul>
                </div>
                <div class="card-body p-4">
                    <div class="tab-content">
                        <!-- Recommended Tab -->
                        <div class="tab-pane fade show active" id="recommended" role="tabpanel">
                            @if (Model.RecommendedChallenges.Any())
                            {
                                <div class="row g-4">
                                    @foreach (var challenge in Model.RecommendedChallenges)
                                    {
                                        <div class="col-xl-4 col-lg-6">
                                            <div class="challenge-card">
                                                <div class="d-flex justify-content-between align-items-start mb-3">
                                                    <span class="badge bg-@(challenge.DifficultyLevel <= 3 ? "success" : challenge.DifficultyLevel <= 6 ? "warning" : "danger")">
                                                        @(challenge.DifficultyLevel <= 3 ? "Легкий" : challenge.DifficultyLevel <= 6 ? "Середній" : "Складний")
                                                    </span>
                                                    <div class="text-primary fw-bold">
                                                        <i class="bi bi-trophy-fill me-1"></i>@challenge.Points
                                                    </div>
                                                </div>
                                                <h5 class="fw-bold mb-2">@challenge.Title</h5>
                                                <p class="text-muted small mb-3">
                                                    @(challenge.Description.Length > 80 ? challenge.Description.Substring(0, 80) + "..." : challenge.Description)
                                                </p>
                                                <div class="mb-3">
                                                    @foreach (var cl in challenge.ChallengeLanguages.Take(3))
                                                    {
                                                        <span class="badge bg-secondary me-1 mb-1">
                                                            <i class="bi bi-code me-1"></i>@cl.Language.Name
                                                        </span>
                                                    }
                                                </div>
                                                <a asp-area="Student" asp-controller="Challenges" asp-action="Details" asp-route-id="@challenge.Id" 
                                                   class="btn btn-primary w-100">
                                                    <i class="bi bi-play-circle me-2"></i>Розпочати
                                                </a>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                            else
                            {
                                <div class="text-center py-5">
                                    <i class="bi bi-check-all text-success" style="font-size: 4rem;"></i>
                                    <h4 class="mt-3 fw-bold">Всі завдання розпочаті!</h4>
                                    <p class="text-muted">Ви розпочали всі доступні завдання. Очікуйте на нові!</p>
                                </div>
                            }
                        </div>

                        <!-- In Progress Tab -->
                        <div class="tab-pane fade" id="inprogress" role="tabpanel">
                            @if (Model.InProgressChallenges.Any())
                            {
                                <div class="row g-4">
                                    @foreach (var challenge in Model.InProgressChallenges)
                                    {
                                        <div class="col-xl-4 col-lg-6">
                                            <div class="challenge-card border-warning">
                                                <div class="d-flex justify-content-between align-items-start mb-3">
                                                    <span class="badge bg-@(challenge.DifficultyLevel <= 3 ? "success" : challenge.DifficultyLevel <= 6 ? "warning" : "danger")">
                                                        @(challenge.DifficultyLevel <= 3 ? "Легкий" : challenge.DifficultyLevel <= 6 ? "Середній" : "Складний")
                                                    </span>
                                                    <span class="badge bg-warning text-dark">
                                                        <i class="bi bi-clock"></i> В процесі
                                                    </span>
                                                </div>
                                                <h5 class="fw-bold mb-2">@challenge.Title</h5>
                                                <p class="text-muted small mb-3">
                                                    @(challenge.Description.Length > 80 ? challenge.Description.Substring(0, 80) + "..." : challenge.Description)
                                                </p>
                                                <div class="mb-3">
                                                    @foreach (var cl in challenge.ChallengeLanguages.Take(3))
                                                    {
                                                        <span class="badge bg-secondary me-1 mb-1">
                                                            <i class="bi bi-code me-1"></i>@cl.Language.Name
                                                        </span>
                                                    }
                                                </div>
                                                <a asp-area="Student" asp-controller="Challenges" asp-action="Details" asp-route-id="@challenge.Id" 
                                                   class="btn btn-warning w-100 text-dark fw-bold">
                                                    <i class="bi bi-arrow-clockwise me-2"></i>Продовжити
                                                </a>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                            else
                            {
                                <div class="text-center py-5">
                                    <i class="bi bi-play-circle text-warning" style="font-size: 4rem;"></i>
                                    <h4 class="mt-3 fw-bold">Немає активних завдань</h4>
                                    <p class="text-muted">Почніть нове завдання прямо зараз!</p>
                                </div>
                            }
                        </div>

                        <!-- Completed Tab -->
                        <div class="tab-pane fade" id="completed" role="tabpanel">
                            @if (Model.CompletedChallenges.Any())
                            {
                                <div class="row g-4">
                                    @foreach (var challenge in Model.CompletedChallenges)
                                    {
                                        <div class="col-xl-4 col-lg-6">
                                            <div class="challenge-card border-success">
                                                <div class="d-flex justify-content-between align-items-start mb-3">
                                                    <span class="badge bg-@(challenge.DifficultyLevel <= 3 ? "success" : challenge.DifficultyLevel <= 6 ? "warning" : "danger")">
                                                        @(challenge.DifficultyLevel <= 3 ? "Легкий" : challenge.DifficultyLevel <= 6 ? "Середній" : "Складний")
                                                    </span>
                                                    <span class="badge bg-success">
                                                        <i class="bi bi-check-circle"></i> Завершено
                                                    </span>
                                                </div>
                                                <h5 class="fw-bold mb-2">@challenge.Title</h5>
                                                <p class="text-muted small mb-3">
                                                    @(challenge.Description.Length > 80 ? challenge.Description.Substring(0, 80) + "..." : challenge.Description)
                                                </p>
                                                <div class="mb-3">
                                                    @foreach (var cl in challenge.ChallengeLanguages.Take(3))
                                                    {
                                                        <span class="badge bg-secondary me-1 mb-1">
                                                            <i class="bi bi-code me-1"></i>@cl.Language.Name
                                                        </span>
                                                    }
                                                </div>
                                                <div class="d-flex gap-2">
                                                    <a asp-area="Student" asp-controller="Challenges" asp-action="Details" asp-route-id="@challenge.Id" 
                                                       class="btn btn-outline-primary flex-grow-1">
                                                        <i class="bi bi-eye me-1"></i>Огляд
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                            else
                            {
                                <div class="text-center py-5">
                                    <i class="bi bi-trophy text-primary" style="font-size: 4rem;"></i>
                                    <h4 class="mt-3 fw-bold">Ще немає завершених завдань</h4>
                                    <p class="text-muted">Завершіть ваше перше завдання!</p>
                                </div>
                            }
                        </div>

                        <!-- Activity Tab -->
                        <div class="tab-pane fade" id="activity" role="tabpanel">
                            @if (Model.RecentActivity.Any())
                            {
                                <div class="activity-timeline">
                                    @foreach (var solution in Model.RecentActivity)
                                    {
                                        <div class="activity-item">
                                            <div class="activity-marker @(solution.IsSuccessful ? "bg-success" : "bg-danger")">
                                                <i class="bi @(solution.IsSuccessful ? "bi-check-lg" : "bi-x-lg") text-white"></i>
                                            </div>
                                            <div class="activity-content">
                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                    <div>
                                                        <h6 class="fw-bold mb-1">@solution.Challenge?.Title</h6>
                                                        <div class="d-flex align-items-center gap-2 flex-wrap">
                                                            <span class="badge bg-@(solution.IsSuccessful ? "success" : "danger")">
                                                                @(solution.IsSuccessful ? "Успішно" : "Невдало")
                                                            </span>
                                                            <small class="text-muted">
                                                                <i class="bi bi-code me-1"></i>@solution.Language?.Name
                                                            </small>
                                                            @if (solution.IsSuccessful)
                                                            {
                                                                <small class="text-success fw-bold">
                                                                    <i class="bi bi-trophy me-1"></i>+@solution.PointsEarned
                                                                </small>
                                                            }
                                                        </div>
                                                        @if (!string.IsNullOrEmpty(solution.ErrorMessage) && !solution.IsSuccessful)
                                                        {
                                                            <small class="text-danger d-block mt-1">
                                                                <i class="bi bi-exclamation-triangle me-1"></i>@solution.ErrorMessage
                                                            </small>
                                                        }
                                                    </div>
                                                    <small class="text-muted">@solution.SubmittedAt.ToString("dd.MM HH:mm")</small>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                            else
                            {
                                <div class="text-center py-5">
                                    <i class="bi bi-inbox text-muted" style="font-size: 4rem;"></i>
                                    <h4 class="mt-3 fw-bold">Ще немає активності</h4>
                                    <p class="text-muted">Ваша активність з'явиться тут після перших рішень</p>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>